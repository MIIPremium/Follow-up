<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø­ÙØ¸ Ø§Ù„Ù…ØªÙˆÙ† - Ø¥ØµØ¯Ø§Ø± Ø§Ù„ÙƒÙ„Ø§ÙˆØ¯ (Firestore)</title>
  <style>
    :root{--primary-color:#3498db;--secondary-color:#2ecc71;--accent-color:#e74c3c;--light-color:#ecf0f1;--dark-color:#2c3e50}
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
    body{background-color:#f5f7fa;color:#333;line-height:1.6}
    .container{width:90%;max-width:1200px;margin:0 auto;padding:20px}
    header{background-color:var(--dark-color);color:#fff;padding:1rem;text-align:center;margin-bottom:2rem;border-radius:5px}
    nav{background-color:var(--primary-color);padding:1rem;margin-bottom:2rem;border-radius:5px}
    nav ul{display:flex;justify-content:center;list-style:none}
    nav ul li{margin:0 15px}
    nav ul li a{color:#fff;text-decoration:none;font-weight:bold;padding:5px 10px;border-radius:3px;transition:background-color .3s}
    nav ul li a:hover{background-color:rgba(255,255,255,.2)}
    .section{background-color:#fff;padding:20px;margin-bottom:20px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,.1);display:none}
    .section.active{display:block}
    h2{color:var(--dark-color);margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid var(--light-color)}
    table{width:100%;border-collapse:collapse;margin-bottom:20px}
    table,th,td{border:1px solid #ddd}
    th,td{padding:12px;text-align:center}
    th{background-color:var(--light-color)}
    tr:nth-child(even){background-color:#f9f9f9}
    .form-group{margin-bottom:15px}
    label{display:block;margin-bottom:5px;font-weight:bold}
    input,select,textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:4px}
    button{background-color:var(--primary-color);color:#fff;border:none;padding:10px 15px;border-radius:4px;cursor:pointer;font-weight:bold}
    button:hover{background-color:#2980b9}
    .btn-danger{background-color:var(--accent-color)}
    .btn-danger:hover{background-color:#c0392b}
    .btn-success{background-color:var(--secondary-color)}
    .btn-success:hover{background-color:#27ae60}
    .card{border:1px solid #ddd;border-radius:5px;padding:15px;margin-bottom:15px;background-color:#fff}
    .card-header{font-weight:bold;margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid #eee}
    .tabs{display:flex;margin-bottom:20px;border-bottom:1px solid #ddd}
    .tab{padding:10px 20px;cursor:pointer;background-color:#f1f1f1;border:1px solid #ddd;border-bottom:none;border-radius:5px 5px 0 0;margin-right:5px}
    .tab.active{background-color:#fff;border-bottom:1px solid #fff;margin-bottom:-1px}
    @media (max-width:768px){nav ul{flex-direction:column;align-items:center}nav ul li{margin:5px 0}.tabs{flex-wrap:wrap}.tab{margin-bottom:5px}}
    .hint{font-size:.9rem;color:#555;margin:.5rem 0}
    .banner{padding:10px;border-radius:6px;margin:10px 20px}
    .banner.warn{background:#fff3cd;border:1px solid #ffe69c;color:#664d03}
    .banner.error{background:#f8d7da;border:1px solid #f5c2c7;color:#842029}
    details.debug{margin:20px}
    details.debug pre{background:#0f172a;color:#e2e8f0;padding:14px;border-radius:8px;overflow:auto}
  </style>
</head>
<body>
  <header>
    <h1>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø­ÙØ¸ Ø§Ù„Ù…ØªÙˆÙ† - Ø§Ù„ÙƒÙ„Ø§ÙˆØ¯ (Google Firestore)</h1>
    <p class="hint">ğŸ“Œ Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø© ØªØ­ÙØ¸ ÙˆØªØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¬Ù…ÙŠØ¹ Ø¹Ø¨Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø­Ø§Ø¨ÙŠØ©. ØªØ£ÙƒØ¯ Ù…Ù† Ø¶Ø¨Ø· <strong>firebaseConfig</strong> Ùˆ<em>Security Rules</em>.</p>
  </header>

  <div id="envBanner" class="banner" style="display:none"></div>

  <nav>
    <ul>
      <li><a href="#" onclick="showSection('students')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</a></li>
      <li><a href="#" onclick="showSection('texts')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙˆÙ†</a></li>
      <li><a href="#" onclick="showSection('progress')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ‚Ø¯Ù…</a></li>
      <li><a href="#" onclick="showSection('weekly')">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</a></li>
      <li><a href="#" onclick="showSection('monthly')">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</a></li>
    </ul>
  </nav>

  <div class="container">
    <!-- Ø§Ù„Ø·Ù„Ø§Ø¨ -->
    <section id="students" class="section">
      <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
      <div class="card">
        <div class="card-header">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</div>
        <form id="addStudentForm">
          <div class="form-group">
            <label for="studentName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label>
            <input type="text" id="studentName" required />
          </div>
          <div class="form-group">
            <label for="studentCollege">Ø§Ù„ÙƒÙ„ÙŠÙ‘Ø©</label>
            <input type="text" id="studentCollege" required />
          </div>
          <div class="form-group">
            <label for="studentMajor">Ø§Ù„ØªØ®ØµØµ</label>
            <input type="text" id="studentMajor" required />
          </div>
          <div class="form-group">
            <label for="studentLevel">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
            <select id="studentLevel" required>
              <option value="1">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„</option>
              <option value="2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
              <option value="3">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø«</option>
              <option value="4">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±Ø§Ø¨Ø¹</option>
            </select>
          </div>
          <button type="submit" class="btn-success">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨</button>
        </form>
      </div>

      <div class="card">
        <div class="card-header">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</div>
        <table id="studentsTable">
          <thead>
            <tr>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„ÙƒÙ„ÙŠÙ‘Ø©</th>
              <th>Ø§Ù„ØªØ®ØµØµ</th>
              <th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
              <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Ø§Ù„Ù…ØªÙˆÙ† -->
    <section id="texts" class="section">
      <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙˆÙ†</h2>
      <div class="tabs">
        <div class="tab active" data-stage="1" onclick="showTextTab('stage1', event)">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</div>
        <div class="tab" data-stage="2" onclick="showTextTab('stage2', event)">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</div>
        <div class="tab" data-stage="3" onclick="showTextTab('stage3', event)">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©</div>
        <div class="tab" data-stage="4" onclick="showTextTab('stage4', event)">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</div>
      </div>

      <!-- Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1 -->
      <div id="stage1Texts" class="text-tab" data-stage="1">
        <div class="card">
          <div class="card-header">Ø¥Ø¶Ø§ÙØ© Ù…ØªÙ† Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</div>
          <form class="addTextForm" data-stage="1">
            <div class="form-group">
              <label>Ø§Ø³Ù… Ø§Ù„Ù…ØªÙ†</label>
              <input type="text" class="textName" required />
            </div>
            <div class="form-group">
              <label>Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„ØµÙØ­Ø§Øª/Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡</label>
              <input type="number" min="1" class="textTotal" required />
            </div>
            <button type="submit" class="btn-success">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªÙ†</button>
          </form>
        </div>
        <div class="card">
          <div class="card-header">Ù…ØªÙˆÙ† Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</div>
          <table class="textsTable" id="stage1TextsTable">
            <thead>
              <tr>
                <th>Ø§Ø³Ù… Ø§Ù„Ù…ØªÙ†</th>
                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</th>
                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2 -->
      <div id="stage2Texts" class="text-tab" data-stage="2" style="display:none">
        <div class="card">
          <div class="card-header">Ø¥Ø¶Ø§ÙØ© Ù…ØªÙ† Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</div>
          <form class="addTextForm" data-stage="2">
            <div class="form-group">
              <label>Ø§Ø³Ù… Ø§Ù„Ù…ØªÙ†</label>
              <input type="text" class="textName" required />
            </div>
            <div class="form-group">
              <label>Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„ØµÙØ­Ø§Øª/Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡</label>
              <input type="number" min="1" class="textTotal" required />
            </div>
            <button type="submit" class="btn-success">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªÙ†</button>
          </form>
        </div>
        <div class="card">
          <div class="card-header">Ù…ØªÙˆÙ† Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</div>
          <table class="textsTable" id="stage2TextsTable">
            <thead>
              <tr>
                <th>Ø§Ø³Ù… Ø§Ù„Ù…ØªÙ†</th>
                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</th>
                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3 -->
      <div id="stage3Texts" class="text-tab" data-stage="3" style="display:none">
        <div class="card">
          <div class="card-header">Ø¥Ø¶Ø§ÙØ© Ù…ØªÙ† Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©</div>
          <form class="addTextForm" data-stage="3">
            <div class="form-group">
              <label>Ø§Ø³Ù… Ø§Ù„Ù…ØªÙ†</label>
              <input type="text" class="textName" required />
            </div>
            <div class="form-group">
              <label>Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„ØµÙØ­Ø§Øª/Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡</label>
              <input type="number" min="1" class="textTotal" required />
            </div>
            <button type="submit" class="btn-success">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªÙ†</button>
          </form>
        </div>
        <div class="card">
          <div class="card-header">Ù…ØªÙˆÙ† Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©</div>
          <table class="textsTable" id="stage3TextsTable">
            <thead>
              <tr>
                <th>Ø§Ø³Ù… Ø§Ù„Ù…ØªÙ†</th>
                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</th>
                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4 -->
      <div id="stage4Texts" class="text-tab" data-stage="4" style="display:none">
        <div class="card">
          <div class="card-header">Ø¥Ø¶Ø§ÙØ© Ù…ØªÙ† Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</div>
          <form class="addTextForm" data-stage="4">
            <div class="form-group">
              <label>Ø§Ø³Ù… Ø§Ù„Ù…ØªÙ†</label>
              <input type="text" class="textName" required />
            </div>
            <div class="form-group">
              <label>Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„ØµÙØ­Ø§Øª/Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡</label>
              <input type="number" min="1" class="textTotal" required />
            </div>
            <button type="submit" class="btn-success">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªÙ†</button>
          </form>
        </div>
        <div class="card">
          <div class="card-header">Ù…ØªÙˆÙ† Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</div>
          <table class="textsTable" id="stage4TextsTable">
            <thead>
              <tr>
                <th>Ø§Ø³Ù… Ø§Ù„Ù…ØªÙ†</th>
                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</th>
                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ‚Ø¯Ù… -->
    <section id="progress" class="section">
      <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ø­ÙØ¸</h2>
      <div class="card">
        <form id="recordProgressForm">
          <div class="form-group">
            <label for="progressStudent">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨</label>
            <select id="progressStudent" required>
              <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨ --</option>
            </select>
          </div>
          <div class="form-group">
            <label for="progressStage">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</label>
            <select id="progressStage" required>
              <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© --</option>
              <option value="1">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</option>
              <option value="2">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option>
              <option value="3">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option>
              <option value="4">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</option>
            </select>
          </div>
          <div class="form-group">
            <label for="progressText">Ø§Ù„Ù…ØªÙ†</label>
            <select id="progressText" required>
              <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ØªÙ† --</option>
            </select>
          </div>
          <div class="form-group">
            <label for="progressAmount">Ø§Ù„Ù‚Ø¯Ø± Ø§Ù„Ù…Ø­ÙÙˆØ¸ (Ù…ÙƒØ§Ù† Ø§Ù„ÙˆÙ‚Ù)</label>
            <input type="number" id="progressAmount" required />
          </div>
          <div class="form-group">
            <label for="progressDate">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù…ÙŠØ¹</label>
            <input type="date" id="progressDate" required />
          </div>
          <button type="submit" class="btn-success">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ‚Ø¯Ù…</button>
        </form>
        <p class="hint">Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ø¹Ø¯Ù… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù‚Ø¯Ø± Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ù…ØªÙ†.</p>
      </div>
    </section>

    <!-- ØªÙ‚Ø§Ø±ÙŠØ± (ØªØ¬Ù‡ÙŠØ² Ù„Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©) -->
    <section id="weekly" class="section">
      <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</h2>
      <div class="card">
        <div class="form-group">
          <label for="weeklyReportWeek">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
          <input type="week" id="weeklyReportWeek" />
        </div>
        <p class="hint">â—ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø³ÙŠØªÙ… Ø±Ø¨Ø·Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Firestore Ø­Ø³Ø¨ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®.</p>
      </div>
      <div class="card">
        <div class="card-header">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</div>
        <table id="weeklyReportTable">
          <thead>
            <tr>
              <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
              <th>Ø§Ù„ÙƒÙ„ÙŠÙ‘Ø©</th>
              <th>Ø§Ù„ØªØ®ØµØµ</th>
              <th>Ø£ÙŠØ§Ù… Ø§Ù„ØªØ³Ù…ÙŠØ¹</th>
              <th>Ø£ÙŠØ§Ù… Ø¹Ø¯Ù… Ø§Ù„ØªØ³Ù…ÙŠØ¹</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section id="monthly" class="section">
      <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h2>
      <div class="card">
        <div class="form-group">
          <label for="monthlyReportMonth">Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±</label>
          <input type="month" id="monthlyReportMonth" />
        </div>
        <p class="hint">â—ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©: Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø²Ù…Ù†ÙŠØ© Ù…Ù† Firestore.</p>
      </div>
      <div class="card">
        <div class="card-header">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
        <table id="monthlyReportTable">
          <thead>
            <tr>
              <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
              <th>Ø§Ù„ÙƒÙ„ÙŠÙ‘Ø©</th>
              <th>Ø§Ù„ØªØ®ØµØµ</th>
              <th>Ø£ÙŠØ§Ù… Ø§Ù„ØªØ³Ù…ÙŠØ¹</th>
              <th>Ø£ÙŠØ§Ù… Ø¹Ø¯Ù… Ø§Ù„ØªØ³Ù…ÙŠØ¹</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- Firebase + Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <script type="module">
    // ===== Ø£Ø¯ÙˆØ§Øª Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¨ÙŠØ¦Ø©/Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ =====
    const banner = document.getElementById('envBanner');
    function showBanner(msg, type='warn'){ banner.textContent = msg; banner.className = `banner ${type}`; banner.style.display='block'; }

    // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (Ø­Ø¯Ù‘Ø«Ù‡Ø§ Ù…Ù† Ù„ÙˆØ­Ø© Firebase) =====
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, collection, addDoc, onSnapshot,
      deleteDoc, doc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const REQUIRED_KEYS = ["apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId"];
    function isValidConfig(cfg){
      if(!cfg) return false;
      for(const k of REQUIRED_KEYS){
        if(!(k in cfg)) return false;
        const v = String(cfg[k]||'');
        if(!v || v.startsWith('YOUR_')) return false;
      }
      return true;
    }

    let app = null, db = null, dbReady = false;
    try{
      if(isValidConfig(firebaseConfig)){
        app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        dbReady = true;
      }else{
        showBanner('âš ï¸ Firebase Ù„Ù… ÙŠÙØ¶Ø¨Ø· Ø¨Ø¹Ø¯. Ø­Ø¯Ù‘Ø« Ù‚ÙŠÙ… firebaseConfig Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­ÙØ¸ Ù…Ø¤Ù‚ØªÙ‹Ø§).', 'warn');
      }
    }catch(err){
      console.error('[Firebase Init Error]', err);
      showBanner('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase: '+ (err?.message||err), 'error');
    }

    // ===== Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¹Ù†Ø¯ ØªÙˆÙÙ‘Ø± Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© =====
    const studentsCol = dbReady ? collection(db, 'students') : null;
    const textsCol    = dbReady ? collection(db, 'texts')    : null; // { name, total, stage }
    const progressCol = dbReady ? collection(db, 'progress') : null; // { studentId, stage, textId, amount, remaining, date }

    // ===== Ø­Ø§Ù„Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… =====
    const studentsState = new Map(); // id -> data
    const textsState    = new Map(); // id -> data

    // ===== Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø© Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© =====
    function showSection(sectionId){
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      const el = document.getElementById(sectionId);
      if(el) el.classList.add('active');
      if(sectionId==='students'){ renderStudentsTable(); }
      if(sectionId==='texts'){ /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ØªØªØ­Ø¯Ù‘Ø« Ø¹Ø¨Ø± onSnapshot */ }
      if(sectionId==='progress'){ loadStudentsDropdown(); }
    }

    function showTextTab(stageId, ev){
      document.querySelectorAll('.text-tab').forEach(tab=>tab.style.display='none');
      const wrap = document.getElementById(stageId+'Texts');
      if(wrap) wrap.style.display='block';
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      // Ø§Ø¬Ø¹Ù„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„ Ù†Ø´Ø·Ù‹Ø§ Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠÙÙ…Ø±Ù‘ÙØ± Ø­Ø¯Ø«
      const stageNum = String(stageId).replace('stage','');
      const tabEl = ev?.target ?? document.querySelector(`.tab[data-stage="${stageNum}"]`);
      tabEl?.classList.add('active');
      renderTextsTables();
    }

    // Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø¯Ø§Ø®Ù„ HTML (Ø­Ù„Ù‘ Ù„Ø®Ø·Ø£ ReferenceError)
    window.showSection = showSection;
    window.showTextTab = showTextTab;

    // ===== Ø§Ù„Ø·Ù„Ø§Ø¨ =====
    const addStudentForm = document.getElementById('addStudentForm');
    addStudentForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const student = {
        name: document.getElementById('studentName').value.trim(),
        college: document.getElementById('studentCollege').value.trim(),
        major: document.getElementById('studentMajor').value.trim(),
        level: document.getElementById('studentLevel').value
      };
      if(!student.name) return alert('Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨');
      if(!dbReady) return alert('Ù„Ù… ÙŠØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Ø¨Ø¹Ø¯. Ø­Ø¯Ù‘Ø« firebaseConfig Ø£ÙˆÙ„Ù‹Ø§.');
      try{ await addDoc(studentsCol, student); addStudentForm.reset(); alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!'); }
      catch(err){ console.error('Add student error', err); alert('ØªØ¹Ø°Ù‘Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨: '+(err?.message||err)); }
    });

    function renderStudentsTable(){
      const tbody = document.querySelector('#studentsTable tbody');
      if(!tbody) return;
      tbody.innerHTML = '';
      [...studentsState.entries()].forEach(([id, student])=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${student.name}</td>
          <td>${student.college}</td>
          <td>${student.major}</td>
          <td>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${student.level}</td>
          <td><button class="btn-danger" data-del-student="${id}">Ø­Ø°Ù</button></td>`;
        tbody.appendChild(tr);
      });
      tbody.querySelectorAll('[data-del-student]').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          const id = btn.getAttribute('data-del-student');
          if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ')){
            if(!dbReady) return alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­Ø°Ù Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø¯Ø§Ø¯ Firebase.');
            try{ await deleteDoc(doc(db, 'students', id)); } catch(err){ console.error('Delete student error', err); alert('ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø­Ø°Ù: '+(err?.message||err)); }
          }
        });
      });
    }

    // Ù…ØªØ§Ø¨Ø¹Ø© Ø­ÙŠÙ‘Ø© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ (Ø¹Ù†Ø¯ ØªÙˆÙØ± Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©)
    if(dbReady){
      onSnapshot(studentsCol, (snap)=>{
        studentsState.clear();
        snap.forEach(d=>studentsState.set(d.id, d.data()));
        renderStudentsTable();
        loadStudentsDropdown();
      }, (err)=>{
        console.error('students snapshot error', err);
        showBanner('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨: '+(err?.message||err), 'error');
      });
    }

    // ===== Ø§Ù„Ù…ØªÙˆÙ† =====
    document.querySelectorAll('.addTextForm').forEach(form=>{
      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const stage = form.getAttribute('data-stage');
        const name = form.querySelector('.textName').value.trim();
        const total = parseInt(form.querySelector('.textTotal').value, 10);
        if(!name || !total || total<1) return alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ØªÙ† ÙˆØ¹Ø¯Ø¯Ù‹Ø§ ØµØ­ÙŠØ­Ù‹Ø§');
        if(!dbReady) return alert('Ù„Ù… ÙŠØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Ø¨Ø¹Ø¯. Ø­Ø¯Ù‘Ø« firebaseConfig Ø£ÙˆÙ„Ù‹Ø§.');
        try{ await addDoc(textsCol, { name, total, stage }); form.reset(); alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªÙ† Ø¨Ù†Ø¬Ø§Ø­!'); }
        catch(err){ console.error('Add text error', err); alert('ØªØ¹Ø°Ù‘Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªÙ†: '+(err?.message||err)); }
      });
    });

    function renderTextsTables(){
      for(let s=1; s<=4; s++){
        const tbody = document.querySelector(`#stage${s}TextsTable tbody`);
        if(!tbody) continue;
        tbody.innerHTML='';
        [...textsState.entries()]
          .filter(([_, t])=> String(t.stage)===String(s))
          .forEach(([id, t])=>{
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${t.name}</td>
              <td>${t.total}</td>
              <td><button class="btn-danger" data-del-text="${id}">Ø­Ø°Ù</button></td>`;
            tbody.appendChild(tr);
          });
        tbody.querySelectorAll('[data-del-text]').forEach(btn=>{
          btn.addEventListener('click', async ()=>{
            const id = btn.getAttribute('data-del-text');
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ØªÙ†ØŸ')){
              if(!dbReady) return alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­Ø°Ù Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø¯Ø§Ø¯ Firebase.');
              try{ await deleteDoc(doc(db,'texts',id)); } catch(err){ console.error('Delete text error', err); alert('ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø­Ø°Ù: '+(err?.message||err)); }
            }
          });
        });
      }
    }

    if(dbReady){
      onSnapshot(textsCol, (snap)=>{
        textsState.clear();
        snap.forEach(d=>textsState.set(d.id, d.data()));
        renderTextsTables();
        populateTextsDropdown();
      }, (err)=>{
        console.error('texts snapshot error', err);
        showBanner('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙ†: '+(err?.message||err), 'error');
      });
    }

    // ===== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ‚Ø¯Ù… =====
    const progressStageSel = document.getElementById('progressStage');
    const progressTextSel  = document.getElementById('progressText');

    function loadStudentsDropdown(){
      const select = document.getElementById('progressStudent');
      if(!select) return;
      const current = select.value;
      select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨ --</option>';
      [...studentsState.entries()].forEach(([id, s])=>{
        const opt = document.createElement('option');
        opt.value = id; opt.textContent = s.name;
        select.appendChild(opt);
      });
      if(current) select.value = current;
      populateTextsDropdown();
    }

    function populateTextsDropdown(){
      if(!progressStageSel || !progressTextSel) return;
      const stage = progressStageSel.value;
      progressTextSel.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ØªÙ† --</option>';
      if(!stage) return;
      [...textsState.entries()]
        .filter(([_, t])=> String(t.stage)===String(stage))
        .forEach(([id, t])=>{
          const opt = document.createElement('option');
          opt.value = id; opt.textContent = t.name; opt.dataset.total = t.total;
          progressTextSel.appendChild(opt);
        });
    }

    progressStageSel.addEventListener('change', populateTextsDropdown);

    document.getElementById('recordProgressForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const studentId = document.getElementById('progressStudent').value;
      const stage     = document.getElementById('progressStage').value;
      const textId    = document.getElementById('progressText').value;
      const amount    = parseInt(document.getElementById('progressAmount').value, 10);
      const date      = document.getElementById('progressDate').value; // YYYY-MM-DD
      if(!studentId || !stage || !textId || !amount || !date) return alert('Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
      const total = parseInt(progressTextSel.selectedOptions[0].dataset.total, 10);
      if(amount>total) return alert('Ø§Ù„Ù‚Ø¯Ø± Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ù…ØªÙ†!');
      const remaining = total - amount;
      if(!dbReady) return alert('Ù„Ù… ÙŠØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Ø¨Ø¹Ø¯. Ø­Ø¯Ù‘Ø« firebaseConfig Ø£ÙˆÙ„Ù‹Ø§.');
      try{ await addDoc(progressCol, { studentId, stage, textId, amount, remaining, date }); e.target.reset(); alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ‚Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!'); }
      catch(err){ console.error('Add progress error', err); alert('ØªØ¹Ø°Ù‘Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ‚Ø¯Ù…: '+(err?.message||err)); }
    });

    // ===== Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ =====
    document.addEventListener('DOMContentLoaded', ()=>{
      showSection('students');
      showTextTab('stage1');
      runSelfTests();
    });

    // ===== Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª (Test Cases) =====
    function logTest(ok, name, info=''){
      const line = `${ok?'âœ…':'âŒ'} ${name}${info?(' â€” '+info):''}`;
      console[ok?'log':'error'](line);
      const pre = document.getElementById('testLog');
      if(pre){ pre.textContent += line + '\n'; }
    }

    function runSelfTests(){
      // TC-1: Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…Ø¹Ø±Ù‘ÙØ© Ø¹Ù„Ù‰ window
      logTest(typeof window.showSection==='function', 'TC-1: showSection Ù…ÙˆØ¬ÙˆØ¯ Ø¹Ù„Ù‰ window');
      logTest(typeof window.showTextTab==='function', 'TC-1b: showTextTab Ù…ÙˆØ¬ÙˆØ¯ Ø¹Ù„Ù‰ window');

      // TC-2: showSection ØªÙØ¸Ù‡Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ØµØ­ÙŠØ­
      showSection('students');
      const visibleStudents = document.getElementById('students').classList.contains('active');
      logTest(visibleStudents, 'TC-2: Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø§Ø¨ Ù†Ø´ÙØ·');

      // TC-3: showTextTab ØªÙÙØ¹Ù‘Ù„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­ Ø­ØªÙ‰ Ø¨Ø¯ÙˆÙ† event
      showTextTab('stage2');
      const tab2Active = document.querySelector('.tab[data-stage="2"]').classList.contains('active');
      const stage2Visible = document.getElementById('stage2Texts').style.display==='block';
      logTest(tab2Active && stage2Visible, 'TC-3: ØªØ¨Ø¯ÙŠÙ„ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2 ÙŠØ¹Ù…Ù„');

      // TC-4: ÙØ­Øµ ØµÙ„Ø§Ø­ÙŠØ© Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
      const cfgOk = isValidConfig(firebaseConfig);
      logTest(cfgOk || !cfgOk, 'TC-4: ÙØ­Øµ firebaseConfig (Ù…Ø¬Ø±Ø¯ ØªÙ‚Ø±ÙŠØ±)', cfgOk? 'OK':'Placeholder/ØºÙŠØ± Ù…ÙƒØªÙ…Ù„');

      // TC-5: populateTextsDropdown ÙŠØ¹Ù…Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© Ø¹Ù†Ø¯Ù…Ø§ Ù„Ø§ ØªØªÙˆÙØ± Ù‚Ø§Ø¹Ø¯Ø©
      if(!dbReady){
        // Ø­Ù‚Ù† Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ©
        const fakeId = 't1';
        textsState.set(fakeId, {name:'Ù…ØªÙ† ØªØ¬Ø±ÙŠØ¨ÙŠ', total:10, stage:'1'});
        document.getElementById('progressStage').value = '1';
        populateTextsDropdown();
        const opts = document.querySelectorAll('#progressText option');
        logTest(opts.length>1, 'TC-5: Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªÙˆÙ† ØªÙÙ…Ù„Ø£ Ø¨Ø¯ÙˆÙ† Firestore', `Ø¹Ø¯Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª: ${opts.length}`);
        // ØªÙ†Ø¸ÙŠÙ
        textsState.delete(fakeId);
        populateTextsDropdown();
      }
    }
  </script>

  <details class="debug">
    <summary>Debug & Tests (Ø§ÙØªØ­ Ù„Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª)</summary>
    <pre id="testLog"></pre>
  </details>

  <!-- ØªÙ„Ù…ÙŠØ­Ø§Øª Ø£Ù…Ø§Ù† Firestore (Ø¶Ø¨Ø·Ù‡Ø§ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…):
  rules_version = '2';
  service cloud.firestore {
    match /databases/{database}/documents {
      // ğŸ‘‡ Ù„Ù„Ø³Ù…Ø§Ø­ Ø§Ù„Ø¹Ø§Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ·ÙˆÙŠØ± ÙÙ‚Ø· (ØºÙŠØ± Ø¢Ù…Ù† Ù„Ù„Ø¥Ù†ØªØ§Ø¬)
      match /{document=**} {
        allow read, write: if true;
      }
      // Ù„Ù„Ø¥Ù†ØªØ§Ø¬: Ø§Ø³ØªØ®Ø¯Ù… Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø¯ÙˆØ§Ø±/Ø§Ù„Ù…Ù„ÙƒÙŠØ©.
    }
  }
  -->
</body>
</html>
